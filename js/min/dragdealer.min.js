(function(a,b){if(typeof define==="function"&&define.amd){define(b)}else{if(typeof module==="object"&&module.exports){module.exports.Dragdealer=b()}else{a.Dragdealer=b()}}}(this,function(){var j=function(q,p){this.options=this.applyDefaults(p||{});this.bindMethods();this.wrapper=this.getWrapperElement(q);if(!this.wrapper){return}this.handle=this.getHandleElement(this.wrapper,this.options.handleClass);if(!this.handle){return}this.init();this.bindEventListeners()};j.prototype={defaults:{disabled:false,horizontal:true,vertical:false,slide:true,steps:0,snap:false,loose:false,speed:0.1,xPrecision:0,yPrecision:0,handleClass:"handle",css3:true,activeClass:"active",tapping:true},init:function(){if(this.options.css3){o(this.handle)}this.value={prev:[-1,-1],current:[this.options.x||0,this.options.y||0],target:[this.options.x||0,this.options.y||0]};this.offset={wrapper:[0,0],mouse:[0,0],prev:[-999999,-999999],current:[0,0],target:[0,0]};this.dragStartPosition={x:0,y:0};this.change=[0,0];this.stepRatios=this.calculateStepRatios();this.activity=false;this.dragging=false;this.tapping=false;this.reflow();if(this.options.disabled){this.disable()}},applyDefaults:function(q){for(var p in this.defaults){if(!q.hasOwnProperty(p)){q[p]=this.defaults[p]}}return q},getWrapperElement:function(p){if(typeof(p)=="string"){return document.getElementById(p)}else{return p}},getHandleElement:function(t,p){var r,s,q;if(t.getElementsByClassName){r=t.getElementsByClassName(p);if(r.length>0){return r[0]}}else{s=new RegExp("(^|\\s)"+p+"(\\s|$)");r=t.getElementsByTagName("*");for(q=0;q<r.length;q++){if(s.test(r[q].className)){return r[q]}}}},calculateStepRatios:function(){var p=[];if(this.options.steps>=1){for(var q=0;q<=this.options.steps-1;q++){if(this.options.steps>1){p[q]=q/(this.options.steps-1)}else{p[q]=0}}}return p},setWrapperOffset:function(){this.offset.wrapper=c.get(this.wrapper)},calculateBounds:function(){var p={top:this.options.top||0,bottom:-(this.options.bottom||0)+this.wrapper.offsetHeight,left:this.options.left||0,right:-(this.options.right||0)+this.wrapper.offsetWidth};p.availWidth=(p.right-p.left)-this.handle.offsetWidth;p.availHeight=(p.bottom-p.top)-this.handle.offsetHeight;return p},calculateValuePrecision:function(){var p=this.options.xPrecision||Math.abs(this.bounds.availWidth),q=this.options.yPrecision||Math.abs(this.bounds.availHeight);return[p?1/p:0,q?1/q:0]},bindMethods:function(){if(typeof(this.options.customRequestAnimationFrame)==="function"){this.requestAnimationFrame=i(this.options.customRequestAnimationFrame,window)}else{this.requestAnimationFrame=i(h,window)}if(typeof(this.options.customCancelAnimationFrame)==="function"){this.cancelAnimationFrame=i(this.options.customCancelAnimationFrame,window)}else{this.cancelAnimationFrame=i(g,window)}this.animateWithRequestAnimationFrame=i(this.animateWithRequestAnimationFrame,this);this.animate=i(this.animate,this);this.onHandleMouseDown=i(this.onHandleMouseDown,this);this.onHandleTouchStart=i(this.onHandleTouchStart,this);this.onDocumentMouseMove=i(this.onDocumentMouseMove,this);this.onWrapperTouchMove=i(this.onWrapperTouchMove,this);this.onWrapperMouseDown=i(this.onWrapperMouseDown,this);this.onWrapperTouchStart=i(this.onWrapperTouchStart,this);this.onDocumentMouseUp=i(this.onDocumentMouseUp,this);this.onDocumentTouchEnd=i(this.onDocumentTouchEnd,this);this.onHandleClick=i(this.onHandleClick,this);this.onWindowResize=i(this.onWindowResize,this)},bindEventListeners:function(){e(this.handle,"mousedown",this.onHandleMouseDown);e(this.handle,"touchstart",this.onHandleTouchStart);e(document,"mousemove",this.onDocumentMouseMove);e(this.wrapper,"touchmove",this.onWrapperTouchMove);e(this.wrapper,"mousedown",this.onWrapperMouseDown);e(this.wrapper,"touchstart",this.onWrapperTouchStart);e(document,"mouseup",this.onDocumentMouseUp);e(document,"touchend",this.onDocumentTouchEnd);e(this.handle,"click",this.onHandleClick);e(window,"resize",this.onWindowResize);this.animate(false,true);this.interval=this.requestAnimationFrame(this.animateWithRequestAnimationFrame)},unbindEventListeners:function(){b(this.handle,"mousedown",this.onHandleMouseDown);b(this.handle,"touchstart",this.onHandleTouchStart);b(document,"mousemove",this.onDocumentMouseMove);b(this.wrapper,"touchmove",this.onWrapperTouchMove);b(this.wrapper,"mousedown",this.onWrapperMouseDown);b(this.wrapper,"touchstart",this.onWrapperTouchStart);b(document,"mouseup",this.onDocumentMouseUp);b(document,"touchend",this.onDocumentTouchEnd);b(this.handle,"click",this.onHandleClick);b(window,"resize",this.onWindowResize);this.cancelAnimationFrame(this.interval)},onHandleMouseDown:function(p){n.refresh(p);f(p);a(p);this.activity=false;this.startDrag()},onHandleTouchStart:function(p){n.refresh(p);a(p);this.activity=false;this.startDrag()},onDocumentMouseMove:function(p){if((p.clientX-this.dragStartPosition.x)===0&&(p.clientY-this.dragStartPosition.y)===0){return}n.refresh(p);if(this.dragging){this.activity=true;f(p)}},onWrapperTouchMove:function(p){n.refresh(p);if(!this.activity&&this.draggingOnDisabledAxis()){if(this.dragging){this.stopDrag()}return}f(p);this.activity=true},onWrapperMouseDown:function(p){n.refresh(p);f(p);this.startTap()},onWrapperTouchStart:function(p){n.refresh(p);f(p);this.startTap()},onDocumentMouseUp:function(p){this.stopDrag();this.stopTap()},onDocumentTouchEnd:function(p){this.stopDrag();this.stopTap()},onHandleClick:function(p){if(this.activity){f(p);a(p)}},onWindowResize:function(p){this.reflow()},enable:function(){this.disabled=false;this.handle.className=this.handle.className.replace(/\s?disabled/g,"")},disable:function(){this.disabled=true;this.handle.className+=" disabled"},reflow:function(){this.setWrapperOffset();this.bounds=this.calculateBounds();this.valuePrecision=this.calculateValuePrecision();this.updateOffsetFromValue()},getStep:function(){return[this.getStepNumber(this.value.target[0]),this.getStepNumber(this.value.target[1])]},getStepWidth:function(){return Math.abs(this.bounds.availWidth/this.options.steps)},getValue:function(){return this.value.target},setStep:function(q,r,p){this.setValue(this.options.steps&&q>1?(q-1)/(this.options.steps-1):0,this.options.steps&&r>1?(r-1)/(this.options.steps-1):0,p)},setValue:function(q,r,p){this.setTargetValue([q,r||0]);if(p){this.groupCopy(this.value.current,this.value.target);this.updateOffsetFromValue();this.callAnimationCallback()}},startTap:function(){if(this.disabled||!this.options.tapping){return}this.tapping=true;this.setWrapperOffset();this.setTargetValueByOffset([n.x-this.offset.wrapper[0]-(this.handle.offsetWidth/2),n.y-this.offset.wrapper[1]-(this.handle.offsetHeight/2)])},stopTap:function(){if(this.disabled||!this.tapping){return}this.tapping=false;this.setTargetValue(this.value.current)},startDrag:function(){if(this.disabled){return}this.dragging=true;this.setWrapperOffset();this.dragStartPosition={x:n.x,y:n.y};this.offset.mouse=[n.x-c.get(this.handle)[0],n.y-c.get(this.handle)[1]];if(!this.wrapper.className.match(this.options.activeClass)){this.wrapper.className+=" "+this.options.activeClass}this.callDragStartCallback()},stopDrag:function(){if(this.disabled||!this.dragging){return}this.dragging=false;var q=this.bounds.availWidth===0?0:((n.x-this.dragStartPosition.x)/this.bounds.availWidth),p=this.bounds.availHeight===0?0:((n.y-this.dragStartPosition.y)/this.bounds.availHeight),t=[q,p];var s=this.groupClone(this.value.current);if(this.options.slide){var r=this.change;s[0]+=r[0]*4;s[1]+=r[1]*4}this.setTargetValue(s);this.wrapper.className=this.wrapper.className.replace(" "+this.options.activeClass,"");this.callDragStopCallback(t)},callAnimationCallback:function(){var p=this.value.current;if(this.options.snap&&this.options.steps>1){p=this.getClosestSteps(p)}if(!this.groupCompare(p,this.value.prev)){if(typeof(this.options.animationCallback)=="function"){this.options.animationCallback.call(this,p[0],p[1])}this.groupCopy(this.value.prev,p)}},callTargetCallback:function(){if(typeof(this.options.callback)=="function"){this.options.callback.call(this,this.value.target[0],this.value.target[1])}},callDragStartCallback:function(){if(typeof(this.options.dragStartCallback)=="function"){this.options.dragStartCallback.call(this,this.value.target[0],this.value.target[1])}},callDragStopCallback:function(p){if(typeof(this.options.dragStopCallback)=="function"){this.options.dragStopCallback.call(this,this.value.target[0],this.value.target[1],p)}},animateWithRequestAnimationFrame:function(p){if(p){this.timeOffset=this.timeStamp?p-this.timeStamp:0;this.timeStamp=p}else{this.timeOffset=25}this.animate();this.interval=this.requestAnimationFrame(this.animateWithRequestAnimationFrame)},animate:function(s,r){if(s&&!this.dragging){return}if(this.dragging){var p=this.groupClone(this.value.target);var q=[n.x-this.offset.wrapper[0]-this.offset.mouse[0],n.y-this.offset.wrapper[1]-this.offset.mouse[1]];this.setTargetValueByOffset(q,this.options.loose);this.change=[this.value.target[0]-p[0],this.value.target[1]-p[1]]}if(this.dragging||r){this.groupCopy(this.value.current,this.value.target)}if(this.dragging||this.glide()||r){this.updateOffsetFromValue();this.callAnimationCallback()}},glide:function(){var p=[this.value.target[0]-this.value.current[0],this.value.target[1]-this.value.current[1]];if(!p[0]&&!p[1]){return false}if(Math.abs(p[0])>this.valuePrecision[0]||Math.abs(p[1])>this.valuePrecision[1]){this.value.current[0]+=p[0]*Math.min(this.options.speed*this.timeOffset/25,1);this.value.current[1]+=p[1]*Math.min(this.options.speed*this.timeOffset/25,1)}else{this.groupCopy(this.value.current,this.value.target)}return true},updateOffsetFromValue:function(){if(!this.options.snap){this.offset.current=this.getOffsetsByRatios(this.value.current)}else{this.offset.current=this.getOffsetsByRatios(this.getClosestSteps(this.value.current))}if(!this.groupCompare(this.offset.current,this.offset.prev)){this.renderHandlePosition();this.groupCopy(this.offset.prev,this.offset.current)}},renderHandlePosition:function(){var p="";if(this.options.css3&&d.transform){if(this.options.horizontal){p+="translateX("+this.offset.current[0]+"px)"}if(this.options.vertical){p+=" translateY("+this.offset.current[1]+"px)"}this.handle.style[d.transform]=p;return}if(this.options.horizontal){this.handle.style.left=this.offset.current[0]+"px"}if(this.options.vertical){this.handle.style.top=this.offset.current[1]+"px"}},setTargetValue:function(p,r){var q=r?this.getLooseValue(p):this.getProperValue(p);this.groupCopy(this.value.target,q);this.offset.target=this.getOffsetsByRatios(q);this.callTargetCallback()},setTargetValueByOffset:function(r,s){var p=this.getRatiosByOffsets(r);var q=s?this.getLooseValue(p):this.getProperValue(p);this.groupCopy(this.value.target,q);this.offset.target=this.getOffsetsByRatios(q)},getLooseValue:function(q){var p=this.getProperValue(q);return[p[0]+((q[0]-p[0])/4),p[1]+((q[1]-p[1])/4)]},getProperValue:function(q){var p=this.groupClone(q);p[0]=Math.max(p[0],0);p[1]=Math.max(p[1],0);p[0]=Math.min(p[0],1);p[1]=Math.min(p[1],1);if((!this.dragging&&!this.tapping)||this.options.snap){if(this.options.steps>1){p=this.getClosestSteps(p)}}return p},getRatiosByOffsets:function(p){return[this.getRatioByOffset(p[0],this.bounds.availWidth,this.bounds.left),this.getRatioByOffset(p[1],this.bounds.availHeight,this.bounds.top)]},getRatioByOffset:function(r,p,q){return p?(r-q)/p:0},getOffsetsByRatios:function(p){return[this.getOffsetByRatio(p[0],this.bounds.availWidth,this.bounds.left),this.getOffsetByRatio(p[1],this.bounds.availHeight,this.bounds.top)]},getOffsetByRatio:function(q,p,r){return Math.round(q*p)+r},getStepNumber:function(p){return this.getClosestStep(p)*(this.options.steps-1)+1},getClosestSteps:function(p){return[this.getClosestStep(p[0]),this.getClosestStep(p[1])]},getClosestStep:function(s){var p=0;var r=1;for(var q=0;q<=this.options.steps-1;q++){if(Math.abs(this.stepRatios[q]-s)<r){r=Math.abs(this.stepRatios[q]-s);p=q}}return this.stepRatios[p]},groupCompare:function(q,p){return q[0]==p[0]&&q[1]==p[1]},groupCopy:function(q,p){q[0]=p[0];q[1]=p[1]},groupClone:function(p){return[p[0],p[1]]},draggingOnDisabledAxis:function(){return(!this.options.horizontal&&n.xDiff>n.yDiff)||(!this.options.vertical&&n.yDiff>n.xDiff)}};var i=function(q,p){return function(){return q.apply(p,arguments)}};var e=function(p,q,r){if(p.addEventListener){p.addEventListener(q,r,false)}else{if(p.attachEvent){p.attachEvent("on"+q,r)}}};var b=function(p,q,r){if(p.removeEventListener){p.removeEventListener(q,r,false)}else{if(p.detachEvent){p.detachEvent("on"+q,r)}}};var f=function(p){if(!p){p=window.event}if(p.preventDefault){p.preventDefault()}p.returnValue=false};var a=function(p){if(!p){p=window.event}if(p.stopPropagation){p.stopPropagation()}p.cancelBubble=true};var n={x:0,y:0,xDiff:0,yDiff:0,refresh:function(p){if(!p){p=window.event}if(p.type=="mousemove"){this.set(p)}else{if(p.touches){this.set(p.touches[0])}}},set:function(r){var q=this.x,p=this.y;if(r.clientX||r.clientY){this.x=r.clientX;this.y=r.clientY}else{if(r.pageX||r.pageY){this.x=r.pageX-document.body.scrollLeft-document.documentElement.scrollLeft;this.y=r.pageY-document.body.scrollTop-document.documentElement.scrollTop}}this.xDiff=Math.abs(this.x-q);this.yDiff=Math.abs(this.y-p)}};var c={get:function(q){var p={left:0,top:0};if(q.getBoundingClientRect!==undefined){p=q.getBoundingClientRect()}return[p.left,p.top]}};var d={transform:l("transform"),perspective:l("perspective"),backfaceVisibility:l("backfaceVisibility")};function l(s){var r="Webkit Moz ms O".split(" "),q=document.documentElement.style;if(q[s]!==undefined){return s}s=s.charAt(0).toUpperCase()+s.substr(1);for(var p=0;p<r.length;p++){if(q[r[p]+s]!==undefined){return r[p]+s}}}function o(p){if(d.backfaceVisibility&&d.perspective){p.style[d.perspective]="1000px";p.style[d.backfaceVisibility]="hidden"}}var m=["webkit","moz"];var h=window.requestAnimationFrame;var g=window.cancelAnimationFrame;for(var k=0;k<m.length&&!h;++k){h=window[m[k]+"RequestAnimationFrame"];g=window[m[k]+"CancelAnimationFrame"]||window[m[k]+"CancelRequestAnimationFrame"]}if(!h){h=function(p){return setTimeout(p,25)};g=clearTimeout}return j}));