function initAzLayout(){var $az=jQuery("#az-list"),w=$az.find("li").outerWidth(),$active=$az.find(".active");jQuery("#az-list .selector").width(w-4).css({left:$active.offset().left}).animate({opacity:1})}function loadKnowledgeData($src,$clone){var $div=$clone,$original=$src;_xhr=jQuery.ajax({type:"post",url:_ajaxurl,data:{action:"get_knowledge_details",id:$original.data("id"),nonce:_nonce},success:function(response){var json;try{json=jQuery.parseJSON(response)}catch(err){return!1}var data={_details:json};$src.data("xhr",data),void 0!==$div&&(showMarkerDetails(data,!1),showKnowledgeDetail($div))}})}function showKnowledgeDetail($div){var cx=(document.documentElement.clientWidth-$div.width())/2,x=(cx-$div.position().left)/2,cy=(document.documentElement.clientHeight-$div.height())/2,y=(cy-$div.position().top)/2,$marker=jQuery("#markerDetails"),left=(document.documentElement.clientWidth-$marker.outerWidth())/2,top=(document.documentElement.clientHeight-$marker.outerHeight())/2;$marker.addClass("no-transition az-marker").css({left:$div.position().left+x,top:$div.position().top+y}).transit({perspective:"500px",rotateY:"90deg",scale:.2,opacity:1},0).data("left",left).data("cx",$div.position().left+x).data("top",top).data("cy",$div.position().top+y).find(".x-close").addClass("no-close"),jQuery($div).transit({x:x,y:y,perspective:"500px",rotateY:"-90deg",scale:1.5},"fast","linear",function(){var x=$marker.data("left")-$marker.data("cx"),y=$marker.data("top")-$marker.data("cy");jQuery("#markerDetails").transit({x:x,y:y,scale:1,opacity:1,rotateY:"0deg"},"fast","linear")})}function parallaxAnimate(id){var $id=$(id);$id.fadeIn()}function recreate_coverflow(letter){_recreate_coverflow&&(_coverflows.forEach(function(coverflow){jQuery("#"+coverflow.dest).fadeOut("fast",function(){jQuery(this).html(""),_recreate_coverflow_data(coverflow,letter)})}),_recreate_coverflow=!1)}function _recreate_coverflow_data(coverflow,letter){var dest=document.getElementById(coverflow.dest),parent=document.createElement("ul"),cat=document.createElement("ul"),empty=!0;parent.id=coverflow.id,parent.classList.add("coverflow-me"),parent.style.display="none",parent.dataset.dest=coverflow.dest,cat.dataset.cat="+ Category one",parent.appendChild(cat),letter=letter.toLowerCase(),coverflow.data.forEach(function(item){if(!(""!==letter&&item.letter!=letter||""!==ajaxData.filter&&ajaxData.filter!=item.marker&&ajaxData.filter!=item.type)){var data=document.createElement("ul"),html='<li data-type="link" data-url="'+item.link+'"></li><li data-thumbnail-path="'+item.img+'"></li><li data-thumbnail-text=""><div class="flowWrapper" style="float: left; width: 100%; height: auto; padding-top: 5px"><p class="largeLabel"><a href="'+item.link+'">'+item.title+'</a></p><ul class="options" style="display: none"><li></li></ul></p></div></li>';data.innerHTML=html,cat.appendChild(data),empty=!1}}),dest.appendChild(parent),empty||(generateCoverflow(),jQuery("#"+coverflow.dest).show())}var _recreate_coverflow=!1;jQuery(document).ready(function($){$("#az-list").length>0&&jQuery(window).resize(function(){initAzLayout()}),$(".the-strips li").mouseenter(function(){$("#bg img").removeClass("active"),$("#bg ."+$(this).data("image")).addClass("active")}),$(".arrows > div").click(function(){var dir=$(this).hasClass("arrow-left")?-1:1,$active=$(".grid-view.active"),$next=dir>0?$active.next(".grid-view"):$active.prev(".grid-view"),activeClass=dir>0?"next":"";$next.length<=0||($active.removeClass("next active").addClass(activeClass),$next.removeClass("next").addClass("active"))})}),jQuery(document).ready(function($){$("#az-list li").click(function(){_recreate_coverflow=!0,$("#az-list li").removeClass("active"),$(this).addClass("active");var letter=$(this).data("item").toLowerCase();ajaxData.letter=letter,""!==letter?($("#az .the-strips li").slideUp(function(){$(this).hide()}),$('#az .the-strips li[data-letter="'+letter+'"]').stop(!0,!1).show().slideDown(),ajaxData.type&&""!==ajaxData.type?($("#grid li").addClass("hide-me"),$('#grid li[data-category="'+ajaxData.category+'"],#grid li[data-type="'+ajaxData.type+'"]').each(function(){$(this).data("letter")==letter&&$(this).removeClass("hide-me")})):($("#grid li").addClass("hide-me"),$('#grid li[data-letter="'+letter+'"]').removeClass("hide-me"))):($("#az .the-strips li").slideDown(),$("#grid li").removeClass("hide-me"),ajaxData.type&&""!==ajaxData.type&&($("#grid li").addClass("hide-me"),$('#grid li[data-category="'+ajaxData.category+'"]').removeClass("hide-me"),$('#grid li[data-type="'+ajaxData.type+'"]').removeClass("hide-me"))),$("#map").is(":visible")&&($("#spinner").addClass("visible"),gmapShowMarkers(map)),$("#coverflow").is(":visible")&&recreate_coverflow(letter),$(".responsive-grid").trigger("reflow")}),$("#az .block").each(function(){loadKnowledgeData($(this))}),$("#az .block").click(function(){_xhr&&_xhr.abort();var $this=$(this);$("#az .block").not($this).addClass("inactive"),jQuery("#menugrayout").addClass("no-close").fadeIn();var $div=$this.clone();$div._original=$this,$div.show().addClass("full-block").css({left:$this.offset().left,top:$this.offset().top,width:$this.outerWidth(),height:$this.outerHeight()}),jQuery("body").append($div),jQuery(this).transit({scale:0,opacity:0},0),jQuery(".mb50.mt8p .block").each(function(i){var $this=jQuery(this);$this!=$div._original&&$this.delay(60*i).transit({scale:0,opacity:0},"fast","easeInBack",function(){jQuery(this).css("opacity","")})}),void 0===$div._original.data("xhr")?loadKnowledgeData($div._original,$div):(showMarkerDetails($div._original.data("xhr"),!1),showKnowledgeDetail($div))}),$("body").on("click","#markerDetails.no-transition .x-close",function(){jQuery("#markerDetails");jQuery("#markerDetails").transit({x:0,y:0,scale:.2,rotateY:"90deg"},"fast","linear",function(){$("#menugrayout").fadeOut(),jQuery("#markerDetails").removeClass("no-transition").find(".x-close").removeClass("no-close");var $src=jQuery(".full-block")._original;jQuery(".mb50.mt8p .block").each(function(i){$this=jQuery(this),$this!=$src&&$this.delay(60*i).transit({scale:1,opacity:1},"fast","easeOutBack")}),jQuery(".full-block").transit({x:0,y:0,perspective:"500px",rotateY:"0deg",scale:1},"fast",function(){$this=jQuery(this),jQuery($this._original).transit({scale:1,opacity:1},0),$this.remove()})})})}),jQuery(document).ready(function($){function rotateTitle($this,toAngle){$this.find(".title").each(function(){var $this=$(this),$letters=$this.find(".title-row span"),$row2=$this.find(".title-row2 span"),ease=0===toAngle?"ease-in":"linear",y=0===toAngle?0:20,speed=400;shuffle($letters),$letters.each(function(j){var index=$(this).index();$(this).stop(!0,!1).delay(j*delayRotate).transition({rotateX:toAngle+"deg",y:y},speed,ease);var clone=$row2.get(index);$(clone).stop(!0,!1).delay(j*delayRotate).transition({rotateX:toAngle+"deg",y:-y},speed,ease)})})}function shuffle(array){for(var temporaryValue,randomIndex,currentIndex=array.length;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),currentIndex-=1,temporaryValue=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array}function showLatests(timeout){timeout=timeout||1200,setTimeout(function(){$("#latest .latest ul").each(function(i){$(this).delay(200*i).transition({y:0,opacity:1},800,"easeOutQuad",function(){rotateTitle($(this),0),$(this).find(".category,.more").addClass("active")})})},timeout)}function disableEmptyLetters(letters){$("#az-list li").each(function(){if(""!==this.dataset.item){var letter=this.dataset.item.toLowerCase();letters.indexOf(letter)<0?this.classList.add("empty"):this.classList.remove("empty")}})}var letters=[];$("#az li").each(function(){$(this);letters.push(this.dataset.letter.toLowerCase())}),disableEmptyLetters(letters),$(".change-view li, .show-latest").click(function(){return $(".categories-toggle, #az-list").removeClass("hidden"),$(".switchers li").removeClass("active"),$this=$(this),$this.addClass("active"),$(".xactive").hide(),$($this.data("id")).removeClass("hide").show().addClass("xactive"),$("body").attr("class",$("body").attr("class").replace(/.tab-[^ ]*/,"")),$("body").addClass("tab-"+$this.data("id")),$this.data("noaz")?$("#az-list").addClass("hidden"):$("#az-list").removeClass("hidden"),$(this).hasClass("show-latest")?$("#latest").removeClass("hide"):$("#latest").addClass("hide"),"#coverflow"==$this.data("id")&&recreate_coverflow($("#az-list li.active").data("item")),"#latest"!=$this.data("id")?$("#categories .description").addClass("hide"):$("#categories .description").removeClass("hide"),$this.data("map")&&($("#map").hasClass("initialized")||(initGMap("map",51.506423,-.125631,!0,!1,12),$("#map").addClass("initialized"))),$this.attr("data-id")?!1:void 0}),$(".switchers .icon-switch").click(function(){var $photo=$("#photo .container");$photo.hasClass("initialized")||($photo.addClass("initialized"),$photo.css({marginLeft:-$photo.width()/2,marginTop:-$photo.height()/2}),$photo.mouseParallax({moveFactor:5,targetContainer:"#photo"}),setTimeout(function($photo){for(var items=pindrops.length,markers=["bank","concerts","famous","flash","historic-buildings","movies","public-places","wifi"],startDelay=0,incDelay=10,speed=700,i=($photo.height()/3,0);items>i;i++){var $pin=$("<img>").hide(),x=pindrops[i].x,y=pindrops[i].y,img=Math.random()*markers.length;img=markers[Math.floor(img)];var src=ajaxData.markersUrl+img+".png";$pin.addClass("pin").attr("src",src).css({left:x+"%",top:y+"%"}).data("category",img),$pin.data("src",pindrops[i].src),$pin.data("title",pindrops[i].title),$pin.data("link",pindrops[i].link),$pin.click(function(e){var $this=$(this),$infow=$("#pin-infowindow");$infow.find("img").attr("src",$this.data("src")),$infow.show();var left=$this.position().left+$this.width()/2-$("#pin-infowindow").outerWidth()/2,top=$this.position().top-$("#pin-infowindow").outerHeight()-20;$infow.find("span").html($this.data("title")),$infow.find("a").attr("href",$this.data("link")),$infow.css({left:left,top:top})}),$photo.append($pin),$pin.transition({y:-$pin.position().top},0).show(),$pin.delay(startDelay+i*incDelay).transition({y:0},speed,"easeOutBounce")}},1e3,$photo))}),$("#pin-infowindow").click(function(){$(this).hide()}),$(".switchers a.icon-360").trigger("click"),$(".categories-toggle").click(function(){$(".categories-list").toggleClass("hidden"),$(this).html($(".categories-list").hasClass("hidden")?"Show full directory":"Hide full directory")}),$(".categories a, .categories-list a").click(function(){_recreate_coverflow=!0;var title=$(this).find(".title").html();void 0===title?title="":(title=title.replace("Show",""),title=title.trim(),title="Showing "+title),$(".category-name").html(title).addClass("border-line"),ajaxData.filter=this.dataset.filter,""===$(this).data("type")?(ajaxData.category=$(this).data("filter"),ajaxData.type="knowledge"):(ajaxData.category="",ajaxData.type=$(this).data("type"));var cat=$(this).data("filter"),$active=$(".row.mt8p > div").not(".hide");($active.length<=0||"latest"==$active.attr("id"))&&$(".switchers .default-view").trigger("click"),$("#map").hasClass("xactive")&&gmapShowMarkers(map),$("#photo img").each(function(){var $this=$(this);""===cat||$this.data("category")==cat?$this.stop(!0,!1).fadeIn():$this.stop(!0,!1).fadeOut()});var letters=[];$("#az li").each(function(){var $this=$(this);if(""===cat||$this.hasClass(cat)||$this.hasClass("post-"+cat)){if(letters.push(this.dataset.letter.toLowerCase()),!$this.data("height"))return;$this.stop(!0,!1).show().animate({height:$this.data("height"),opacity:1},"slow")}else $this.data("height")||$this.data("height",$this.outerHeight()),$this.stop(!0,!1).animate({height:0,opacity:0},"slow",function(){$(this).hide()})}),disableEmptyLetters(letters),$("#coverflow").is(":visible")&&recreate_coverflow($("#az-list li.active").data("item")),""!==cat?($("#grid li").addClass("hide-me"),$('#grid li[data-category="'+cat+'"]').removeClass("hide-me"),$('#grid li[data-type="'+cat+'"]').removeClass("hide-me")):$("#grid li").removeClass("hide-me"),$(".responsive-grid").trigger("reflow"),$(this).closest("#latest").length<=0&&($(".categories-list").toggleClass("hidden"),$(".categories-toggle").html($(".categories-list").hasClass("hidden")?"Show full directory":"Hide full directory"))});var width=window.innerWidth/3.8,height=width/(16/9),halfWidth=width/2.6,left=-width+halfWidth,delayRotate=30,stopPosition=0,slideItems=[],slideSpace=10;$("#latest .arrow").width(halfWidth/1.4).height(height),$("#latest .latest").data("slideWidth",width).data("slideHalfWidth",halfWidth),$("#latest .container").height(height),$("#skip").click(function(){$("#overlay-boxes .box1").delay(1e3).transition({y:"-200%"},800,function(){$(this).hide()}),$("#overlay-boxes .box2").delay(1e3).transition({y:"200%"},800,function(){$(this).hide()});var top=jQuery(".columns.switchers").outerHeight()-7,h=jQuery("#home").height()-top-jQuery("#footer").outerHeight(),$latest=jQuery("#latest");$latest.css({top:top}).height(h),$(this).fadeOut()}),$(".scroll-down").click(function(){showLatests()}),$(window).load(function(){$("parallax").length<=0&&($("#overlay-boxes .box1").delay(800).transition({y:"-200%"},800,function(){$(this).hide()}),$("#overlay-boxes .box2").delay(800).transition({y:"200%"},800,function(){$(this).hide()}),_show_filter&&($('#categories a[data-filter="'+_show_filter+'"]').trigger("click"),$(".categories-list").addClass("hidden")),showLatests(700),video1.play())}),$("#latest .latest ul").each(function(i){var $this=$(this);$this.width(width),$this.height(height),$this.css({left:left}),$this.transition({y:window.innerHeight-$(this).offset().top},0),$this.mouseenter(function(){rotateTitle($(this),90)}).mouseleave(function(){rotateTitle($(this),0)}),left+=width+slideSpace,slideItems.push(this)}),$("#latest .left-arrow").mouseenter(function(e){var $latest=$(this).parent().find(".latest");$latest.stop(!0,!1).transition({x:stopPosition+100},"ease")}).mouseleave(function(){var $latest=$(this).parent().find(".latest");$latest.stop(!0,!1).transition({x:stopPosition},"ease")}),$("#latest .right-arrow").mouseenter(function(e){var $latest=$(this).parent().find(".latest");$latest.stop(!0,!1).transition({x:stopPosition-100},"ease")}).mouseleave(function(){var $latest=$(this).parent().find(".latest");$latest.stop(!0,!1).transition({x:stopPosition},"ease")}),$("#latest .arrow").click(function(){if(!$(this).hasClass("animating")){$(this).addClass("animating");var latest,dir=$(this).hasClass("right-arrow"),$latest=$(this).parent().find(".latest"),width=$latest.data("slideWidth"),x=($latest.data("slideHalfWidth"),getMatrixM40($latest.get()[0])),index=1,left=width+slideSpace,sign=1;dir?(latest=slideItems.shift(),slideItems.push(latest),index=slideItems.length-2,sign=-1):(latest=slideItems.pop(),slideItems.unshift(latest),left*=-1),dir||(left+=parseFloat(slideItems[index].style.left),$(latest).css({left:left})),stopPosition=x+(width+slideSpace)*sign-100*sign,$latest.stop(!0,!0).transition({x:stopPosition+100*sign},"ease",function(){dir&&(left+=parseFloat(slideItems[index].style.left),$(latest).css({left:left})),$("#latest .arrow").removeClass("animating")})}})}),jQuery(window).load(function(){jQuery("article.animated-text").parent().css({left:"25%"});var top=jQuery("#categories").position().top+jQuery("#categories").height()-jQuery(".mb50.mt8p").position().top-2,h=jQuery("#home").height()-top-jQuery("#footer").outerHeight(),$latest=jQuery("#latest");$latest.css({top:top}).height(h)}),function($){$.fn.extend({mouseParallax:function(options){var defaults={moveFactor:5,rotateFactor:5,zIndexValue:"-1",targetContainer:"body"};return options=$.extend(defaults,options),this.each(function(){var o=options,background=$(this);$(o.targetContainer).on("mousemove",function(e){mouseX=e.pageX,mouseY=e.pageY,windowWidth=$(window).width(),windowHeight=$(window).height(),percentX=mouseX/windowWidth*o.moveFactor-o.moveFactor/2,percentY=mouseY/windowHeight*o.moveFactor-o.moveFactor/2,leftString=0-percentX+"%",rightString=0-percentX+"%",topString=0-percentY+"%",bottomString=0-percentY+"%",rotateX=mouseX/windowWidth*o.rotateFactor-o.rotateFactor/2+"deg",rotateY=mouseY/windowHeight*o.rotateFactor-o.rotateFactor/2+"deg",background[0].style.transform="translateX("+leftString+") translateY("+topString+") rotateX("+rotateY+") rotateY( "+rotateY+")"})})}})}(jQuery);