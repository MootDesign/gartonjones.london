(function(a){a.StreetviewSequence=function(r,e){var i;var u;var d;var t;var n={duration:1,easeHeading:Power0.easeIn,easePitch:Power0.easeIn,easeRoute:Power0.easeIn,headingSkewStart:0,height:150,loop:false,pitchSkewStart:0,sensor:false,totalFrames:75,width:300};var z={};var o;var v;var A;var q;var j;var f;function k(){_.defaults(e,n);i=$("<canvas />");u=(r instanceof jQuery)?r:$(r);u.append(i);d=i.get(0);t=d.getContext("2d");o=[];v=0;q=$.Deferred();j=new google.maps.StreetViewService();d.height=e.height;d.width=e.width;if("undefined"===typeof e.headingSkewEnd){e.headingSkewEnd=e.headingSkewStart}if("undefined"===typeof e.pitchSkewEnd){e.pitchSkewEnd=e.pitchSkewStart}f=TweenLite.to({currentTime:0},e.duration/1000,{currentTime:e.duration,onComplete:h,onReverseComplete:h,onUpdate:m,paused:true});C()}function b(E,F,H,D){var G;G=D-H;return H+G*F.getRatio(E)}function m(){var E=f.progress();var D=Math.round(E*(e.totalFrames-1));o[D].done(function(F){t.drawImage(F,0,0)})}function h(){if(!e.loop){i.trigger("ended");return}if(f.reversed()){f.restart()}else{f.reverse()}}function p(D){return("function"===typeof D.lng)?D.lng():D.lng}function x(D){return("function"===typeof D.lat)?D.lat():D.lat}function B(){var D;D=e.location;if("undefined"===typeof z[D]){z[D]=c(e.location).then(function(E){return{location:e.location,heading:E,pitch:0}})}return z[D]}function s(I){var F;var E;var H;var D;var G;G=e.route.routes[0].overview_path;E=$.Deferred();D=b(I,e.easeRoute,0,G.length-1);F=G[Math.round(D)];H=function(J,K){if(google.maps.StreetViewStatus.OK!==K){E.reject({error:new Error("Unable to get location panorama"),status:K});return}E.resolve({location:J.location.latLng,heading:J.tiles.centerHeading,pitch:J.tiles.originPitch})};j.getPanoramaByLocation(F,50,H);return E.promise()}function c(E){var D=new $.Deferred();j.getPanoramaByLocation(E,50,function(G,F){if(google.maps.StreetViewStatus.OK!==F){D.reject({error:new Error("StreetViewStatus is not OK"),status:F});return}if(0===G.links.length){D.reject({error:new Error("Nearby panorama not found")});return}D.resolve(G.links[0].heading,""===G.links[0].description)});return D.promise()}function w(E){var D="/maps/api/streetview";var H;var F={};var G;H=("undefined"!==typeof E.domain)?E.domain:window.location.protocol+"//maps.googleapis.com";if("undefined"!==typeof E.key){F.key=E.key}F.sensor=E.sensor;F.size=E.width+"x"+E.height;F.location=x(E.location)+","+p(E.location);if("undefined"!==typeof E.heading){F.heading=E.heading}if("undefined"!==typeof E.pitch){F.pitch=E.pitch}if("undefined"!==typeof E.client){F.client=E.client}G=H+D+"?"+$.param(F);return G}function l(){v+=1;q.notify(v/e.totalFrames);if(v===e.totalFrames){q.resolve(A)}}function C(){var F;var E;var D;var I;var G;var H;D=function(J){return function(M){var K=_.clone(M);var L;K.heading+=b(J,e.easeHeading,e.headingSkewStart,e.headingSkewEnd);K.pitch+=b(J,e.easePitch,e.pitchSkewStart,e.pitchSkewEnd);K.sensor=e.sensor;K.key=e.key;K.height=e.height;K.width=e.width;K.client=e.client;K.domain=e.domain;L=new Image();L.onload=l;L.src=w(K);return L}};I=function(){return function(){l();return new Image()}};E=("undefined"===typeof e.route)?B:s;for(F=0;F<e.totalFrames;F+=1){H=(F/(e.totalFrames-1));G=E(H).then(D(H),I(H));o.push(G)}}function g(){f.pause()}function y(){f.resume()}k();A={getStreetHeading:c,getStreetViewImageURL:w,pause:g,play:y};return q.promise()}}("undefined"!==typeof __scope__?__scope__:window));